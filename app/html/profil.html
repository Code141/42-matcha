<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>

<?php $user = $this->data['profil'];?>
<?php $like = $user['like'];?>
<section id="profil">
	<div class="profil_top">
		<?php echo $user['username']; ?>
	</div>
	<div class='profil_body'>
	<div class="interact_flex">
	<div class="interact">

	<div id="user_like_<?php echo $user['id']?>" class="user_like_status">
	</div>

	</div>
	<div class="interact">
	<a href="<?php echo SITE_ROOT . 'ajax/block/' . $user['id']; ?>">
		Block
		<div class="glyphicons glyph_ban"></div>
	</a>
	</div>
	<div class="interact">
		<a id="" onclick="report(<?php echo $user['id']?>)">
			Report
			<div class="glyphicons glyph_bug"></div>
		</a>
	</div>
</div>

	<div id="profil_pic">
	<?php if (!$user['id_media']){ ?>
		<img id="profil_pic" src="<?php echo IMG_PATH . 'default-user-image.png';?>">
	<?php } else { ?>
		<img id="profil_pic" src="<?php echo MEDIA_PATH . $user['id_media'] . '.png';?>">
	<?php } ?>
	</div>


	<div id="last_connection">
		LAST CONNECTION : <?php echo last_connection($user['last_connexion']); ?>
	</div>

	<div id="score">
		SCORE: <?php echo $user['score']; ?> / 10
	</div>


</div>
</section>
<section id='infos'>
	<div class="profil_top">
		<form id="radio_form" action="">
			<table>
				<th>
					<input id="i_general_information" value="div_general_information"type="radio" name="section" checked>
					<label for="i_general_information">
						General
						</label>
				</th>
				<th>
					<input id="i_bio" value="_bio"type="radio" name="section">
					<label for="i_bio">
						Bio
					</label>
				</th>
				<th>
					<input id="i_pictures" value="div_pictures" type="radio" name="section">
					<label for="i_pictures">
						Pictures
					</label>
				</th>
				<th>
					<input id="i_matching_preferences" value="div_matching_preferences" type="radio" name="section">
					<label for="i_matching_preferences">
						Matching preferences
					</label>
				</th>
				<th>
					<input id="i_tags" value="div_tags" type="radio" name="section">
					<label for="i_tags">
						Tags
					</label>
				</th>
			</table>
		</form>
	</div>
	<div class='profil_body' id="div_infos">
	
		<div id="div_general_information">
		<div id="map"></div>
		<div id="more_info">
			<p>
		<span>Firstname</span>
			<?php echo $user['firstname']; ?>
		</p>
		<p>
		<span>Lastname</span>
			<?php echo $user['lastname']; ?>
		</p>
		<p>
		<span>Gender</span>
			<?php echo $user['gender_name']; ?>
		</p>
		<p>
		<span>Gender identity</span>
			<?php echo $user['gender_identity_name']; ?>
		</p>
		<p>
		<span>Age</span>
			<?php echo date_diff(date_create($user['birthdate']), date_create('today'))->y . " years old"; ?>
		</p>	
		<p>
		<span>Birthdate</span>
			<?php echo $user['birthdate']; ?>
		</p>	
		<p>
		<span>Email</span>
			<?php echo $user['email']; ?>
		</p>
	</div>
	</div>
	
	<div id="div_bio">

	<p id="bio">
			<?php echo $user['bio'];?>
	</p>

	</div>

	<div id="div_matching_preferences">
		<table id="preferences">
			<tr>
			<th>gender</th>
			<th>gender_indentity</th>
			<tr>

		<?php foreach($user['orientations'] as $value) { ?>
			<tr>
				<td><?php echo $value['gender_name'];?></td>
				<td><?php echo $value['gender_identity_name']; ?></td>
			</tr>
		<?php } ?>
		</table>
		</div>	
	<div id="div_pictures">
		<div class="flex_wrap">
		<?php  if($user['media']) { foreach($user['media'] as $media){ ?>
		<div class="pic">
			<a class="a_pic" href="" title="view full picture">
			<img id="<?php echo $media['id_media'];?>" src="<?php echo MEDIA_PATH . $media['id_media'] . '.png';?>">
			</a>
		</div>
		<?php }}?>
		</div>
	</div>
	
	<div id="div_tags">
	<legend>tags</legend>
	<div id="tag">
		<?php foreach($user['tags'] as $value) { ?>
		<p>
		<?php echo "#".$value['tag_name'] ?>
		</p>
		<?php } ?>
	</div>
	</div>

	</div>
</section>

<script>
var media_path = "<?php echo MEDIA_PATH;?>";
		user_like_data[<?php echo $user['id']?>] = Array();
		user_like_data[<?php echo $user['id']?>]['id'] = parseInt(<?php echo $user['id']?>);
		user_like_data[<?php echo $user['id']?>]['u1'] = parseInt(<?php echo $like['u1'];?>);
		user_like_data[<?php echo $user['id']?>]['u1_revoked'] = parseInt(<?php echo $like['u1_revoked'];?>);
		user_like_data[<?php echo $user['id']?>]['u2'] = parseInt(<?php echo $like['u2'];?>);
		user_like_data[<?php echo $user['id']?>]['u2_revoked'] = parseInt(<?php echo $like['u2_revoked'];?>);
</script>
<script>

window.addEventListener('load', initMap);
window.addEventListener('load', initEvents);

function initMap()
{
	map = new L.map('map');

	var user_location = { "lat" : <?php echo $user['latitude'];?>, "lon" : <?php echo $user['longitude'];?> };
	var marker = L.marker([user_location.lat, user_location.lon]).addTo(map);
	marker.bindPopup("<b>Your location</b><br>").openPopup();

	map.setView([user_location.lat, user_location.lon], 13);

	var osm = new L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
	attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a>',
		minZoom: 2,
		maxZoom: 18
	}).addTo(map);
}

function full_img(id_media)
{
	var section = document.getElementsByClassName("center")[0];
	var wrap = document.createElement('div');
		wrap.style.position = 'absolute';
		wrap.style.left = '0px';
		wrap.style.height = '100vh';
		wrap.style.width = '100vw';
		wrap.style.backgroundColor = 'rgba(0,0,0,0.5)';
	var img = document.createElement('img');
		img.style.position = 'absolute';
		img.src = media_path + id_media + '.png';
	wrap.appendChild(img);
	section.appendChild(wrap);
	wrap.addEventListener('click', function(){
		wrap.remove();});
}

function	initEvents()
{
	var div_infos = document.getElementById("div_infos");
	var form = document.getElementById("radio_form");
	form.addEventListener("change", function(e){
		for (var i = 0; i < div_infos.childNodes.length; i++)
		{
			if (div_infos.childNodes[i].id)
				div_infos.childNodes[i].style.display = "none";
		}
		var div = document.getElementById(e.target.value);
			div.style.display = "block";
	});
	
	var full_img = document.getElementsByClassName("a_pic");
		for (var i = 0; i < full_img.length; i++)
		{
			full_img[i].addEventListener('click', function(e){
				e.preventDefault();
				var id_media = e.target.id;
				var section = document.getElementsByClassName("center")[0];
	var wrap = document.createElement('div');
		wrap.style.position = 'absolute';
		wrap.style.left = '0px';
		wrap.style.height = '100vh';
		wrap.style.width = '100vw';
		wrap.style.backgroundColor = 'rgba(0,0,0,0.5)';
	var img = document.createElement('img');
		img.style.position = 'absolute';
		img.id = 'full_img';
		img.src = media_path + id_media + '.png';
	wrap.appendChild(img);
	section.appendChild(wrap);
	wrap.addEventListener('click', function(){
		wrap.remove();});
			});
		}

}
</script>
