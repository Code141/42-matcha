<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script>

function showMessage(messageHTML) {
	$('.msg_box').append(messageHTML);
}

$(document).ready(function()
{
	url = "ws://localhost:8090/toto";
	if ("WebSocket" in window)
		websocket = new WebSocket(url);
	else if ("MozWebSocket" in window)
		websocket = new MozWebSocket(url);


	websocket.onopen = function(event)
	{
		showMessage("<div class='chat-connection-ack'>Connection is established!</div>");	
		var messageJSON = {ssid: "<?php echo session_id(); ?>"};
		websocket.send(JSON.stringify(messageJSON));
	}

	window.onbeforeunload = function()
	{
		websocket.onclose = function () {}; // disable onclose handler first
		websocket.close();
	};

	websocket.onmessage = function(event)
	{
		var data = JSON.parse(event.data);
		console.log(data);
		showMessage("<div class='"+data.message_type+"'>"+data.message+"</div>");
		$('#chat-message').val('');
	};

	websocket.onerror = function(event)
	{
		showMessage("<div class='error'>Problem due to some Error</div>");
		console.log(event);
	};

	websocket.onclose = function(event)
	{
		showMessage("<div class='chat-connection-ack'>Connection Closed</div>");
	}; 

	$('.frmChat').on("submit", function(event)
	{
		event.preventDefault();
		var messageJSON = {
		ssid: "<?php echo session_id(); ?>",
			chat_message: $('#chat-message').val()
		};
		websocket.send(JSON.stringify(messageJSON));
	});
});
</script>

	<div id="chat_list">
		chatlist
	</div>

	<div class="conv">
			<div class="conv_name">
				Fiofy
			</div>
		<div class="conv_elem">
			<div class="msg_box">
			</div>
			<form name="frmChat" class="frmChat">
				<input type="text" name="chat-message" id="chat-message" placeholder="Message"  class="chat-input chat-message"   autocomplete="off"/>
				<input type="submit" class="btnSend" name="send-chat-message" value="Send" >
			</form>
		</div>
	</div>

